<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pycalculix.feamodel &mdash; pycalculix  documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="pycalculix  documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">pycalculix  documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pycalculix.feamodel</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Polygon</span>  <span class="c"># needed for plotting elements</span>
<span class="kn">from</span> <span class="nn">matplotlib.collections</span> <span class="kn">import</span> <span class="n">PatchCollection</span>  <span class="c"># element plotting</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="kn">as</span> <span class="nn">colors</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="kn">as</span> <span class="nn">cmx</span>
<span class="kn">import</span> <span class="nn">subprocess</span> <span class="c"># used to launch meshers cgx and gmsh</span>
<span class="kn">import</span> <span class="nn">os</span> <span class="c"># used to delete files written by cgx</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">linspace</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">environment</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">base_classes</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">geometry</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">material</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">components</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">loads</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">mesh</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">part</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">model</span>

<span class="c"># element colors, 0-1, 0=black, 1=whate</span>
<span class="n">_ecolor</span> <span class="o">=</span> <span class="s">&#39;.4&#39;</span>
<span class="n">_fcolor</span> <span class="o">=</span> <span class="s">&#39;.9&#39;</span>

<div class="viewcode-block" id="FeaModel"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel">[docs]</a><span class="k">class</span> <span class="nc">FeaModel</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">ccx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cgx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">gmsh</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">Itemlist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">Itemlist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">areas</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">Itemlist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parts</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">Itemlist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matls</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">Itemlist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">Itemlist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loads</span> <span class="o">=</span> <span class="p">{}</span>    <span class="c"># store loads by time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">Itemlist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">Meshlist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">Meshlist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">faces</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sel</span> <span class="o">=</span> <span class="p">{}</span>   <span class="c"># this selected set is what we&#39;ll plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c"># 0 is model set-up, 1 is first step, etc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
        
        <span class="c"># fix the paths to the needed programs, ccx, cgx, and gmsh</span>
        <span class="k">if</span> <span class="n">ccx</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">environment</span><span class="o">.</span><span class="n">CCX</span> <span class="o">=</span> <span class="n">ccx</span>
        <span class="k">if</span> <span class="n">cgx</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">environment</span><span class="o">.</span><span class="n">CGX</span> <span class="o">=</span> <span class="n">cgx</span>
        <span class="k">if</span> <span class="n">gmsh</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">environment</span><span class="o">.</span><span class="n">GMSH</span> <span class="o">=</span> <span class="n">gmsh</span>
        
<div class="viewcode-block" id="FeaModel.select"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.select">[docs]</a>    <span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span> <span class="o">=</span> <span class="s">&#39;all&#39;</span><span class="p">,</span> <span class="n">byfaces</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="c"># set the selected item to the passed item or list of elements</span>
        <span class="c"># if byfaces is set to true, only elements with faces selected will be</span>
        <span class="c"># shown</span>

        <span class="n">allsel</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">items</span> <span class="o">==</span> <span class="s">&#39;all&#39;</span><span class="p">:</span>
                <span class="n">allsel</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;elements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;points&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;lines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;areas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">areas</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;Selected all&#39;</span><span class="p">)</span>                

        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listify</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;selected&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">items</span>

        <span class="k">if</span> <span class="n">allsel</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="c"># select children</span>
            <span class="n">mystr</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
            <span class="n">mystr</span> <span class="o">=</span> <span class="s">&#39;+&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mystr</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Selected: &#39;</span><span class="o">+</span><span class="n">mystr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sel_children</span><span class="p">(</span><span class="n">byfaces</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FeaModel.sel_children"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.sel_children">[docs]</a>    <span class="k">def</span> <span class="nf">sel_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">byfaces</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="c"># this selects the children of the selected items</span>
        <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">,</span><span class="s">&#39;elements&#39;</span><span class="p">,</span><span class="s">&#39;faces&#39;</span><span class="p">,</span><span class="s">&#39;points&#39;</span><span class="p">,</span><span class="s">&#39;lines&#39;</span><span class="p">,</span><span class="s">&#39;areas&#39;</span><span class="p">]</span>
        <span class="c"># zero out the selection dict</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;selected&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Node</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Element</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;elements&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">child_nodes</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">child_nodes</span> <span class="p">)</span>
                
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Face</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;faces&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">geometry</span><span class="o">.</span><span class="n">Point</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;points&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;elements&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;elements&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">e</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span> <span class="p">)</span>
                    
            <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">geometry</span><span class="o">.</span><span class="n">Line</span><span class="p">)</span> <span class="ow">or</span> 
                  <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">geometry</span><span class="o">.</span><span class="n">Arc</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;points&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">_points_</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;lines&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;faces&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">byfaces</span><span class="p">:</span>
                    <span class="c"># add elements from face only</span>
                    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">faces</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;elements&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">element</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">f</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span> <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># add elements connected to selected nodes, add their nodes </span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;elements&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;elements&#39;</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">e</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span> <span class="p">)</span>
                        
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">geometry</span><span class="o">.</span><span class="n">Area</span><span class="p">):</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get_points</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;points&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;lines&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;faces&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;elements&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
                
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">part</span><span class="o">.</span><span class="n">Part</span><span class="p">):</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get_points</span><span class="p">()</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get_lines</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;points&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;lines&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;faces&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;elements&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FeaModel.set_units"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.set_units">[docs]</a>    <span class="k">def</span> <span class="nf">set_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">temp</span><span class="o">=</span><span class="s">&#39;K&#39;</span><span class="p">):</span>
        <span class="c"># sets the units that will be displayed when plotting</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;displ&#39;</span><span class="p">,</span><span class="s">&#39;force&#39;</span><span class="p">,</span><span class="s">&#39;stress&#39;</span><span class="p">,</span><span class="s">&#39;temp&#39;</span><span class="p">,</span> <span class="s">&#39;density&#39;</span><span class="p">,</span> <span class="s">&#39;time&#39;</span><span class="p">]</span>
        
        <span class="n">m_N</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;m&#39;</span><span class="p">,</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="s">&#39;Pa&#39;</span><span class="p">,</span><span class="s">&#39;K&#39;</span><span class="p">,</span> <span class="s">&#39;kg/(m^3)&#39;</span><span class="p">,</span> <span class="s">&#39;s&#39;</span><span class="p">]</span>
        <span class="n">mm_N</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;mm&#39;</span><span class="p">,</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="s">&#39;MPa&#39;</span><span class="p">,</span><span class="s">&#39;K&#39;</span><span class="p">,</span><span class="s">&#39;tonne/(mm^3)&#39;</span><span class="p">,</span> <span class="s">&#39;s&#39;</span><span class="p">]</span>
        <span class="n">in_lbf</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;in&#39;</span><span class="p">,</span><span class="s">&#39;lbf&#39;</span><span class="p">,</span><span class="s">&#39;psi&#39;</span><span class="p">,</span><span class="s">&#39;R&#39;</span><span class="p">,</span> <span class="s">&#39;slinch/(in^3)&#39;</span><span class="p">,</span> <span class="s">&#39;s&#39;</span><span class="p">]</span>
        <span class="n">ft_lbf</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;ft&#39;</span><span class="p">,</span><span class="s">&#39;lbf&#39;</span><span class="p">,</span><span class="s">&#39;psf&#39;</span><span class="p">,</span><span class="s">&#39;R&#39;</span><span class="p">,</span> <span class="s">&#39;slug/(ft^3)&#39;</span><span class="p">,</span> <span class="s">&#39;s&#39;</span><span class="p">]</span>
        <span class="n">dicts</span> <span class="o">=</span> <span class="p">[</span><span class="n">m_N</span><span class="p">,</span> <span class="n">mm_N</span><span class="p">,</span> <span class="n">in_lbf</span><span class="p">,</span> <span class="n">ft_lbf</span><span class="p">]</span>
        
        <span class="c"># pick correct dict list</span>
        <span class="n">dist_unit</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dicts</span><span class="p">]</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">dist_unit</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">dicts</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
        
        <span class="c"># set values</span>
        <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">vals</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;dist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;displ&#39;</span><span class="p">]</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Units have been set to </span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;dist&#39;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;force&#39;</span><span class="p">]))</span>        
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span> <span class="s">&#39;For </span><span class="si">%s</span><span class="s"> use </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">d</span>
        </div>
<div class="viewcode-block" id="FeaModel.get_units"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.get_units">[docs]</a>    <span class="k">def</span> <span class="nf">get_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="c"># returs units for the passed argumnets</span>
        
        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">mystr</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">:</span>
                <span class="c"># check if the requested item is in the units dict</span>
                <span class="n">mystr</span> <span class="o">=</span> <span class="s">&#39; (&#39;</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
            <span class="k">elif</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">FIELDTYPE</span><span class="p">:</span>
                <span class="c"># return units on results dict item, ex: stress, strain etc</span>
                <span class="n">ftype</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">FIELDTYPE</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">ftype</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">:</span>
                    <span class="n">mystr</span> <span class="o">=</span> <span class="s">&#39; (&#39;</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="n">ftype</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mystr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>
        </div>
<div class="viewcode-block" id="FeaModel.set_time"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.set_time">[docs]</a>    <span class="k">def</span> <span class="nf">set_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="c"># sets the time in the feamodel (preprocessor)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time</span>
        </div>
<div class="viewcode-block" id="FeaModel.get_item"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.get_item">[docs]</a>    <span class="k">def</span> <span class="nf">get_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="c"># return item from part given string identifying item</span>
        <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;P&#39;</span><span class="p">:</span>
            <span class="c"># get point</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span>
            <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">num</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;L&#39;</span><span class="p">:</span>
            <span class="c"># get line</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span>
            <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">num</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;A&#39;</span><span class="p">:</span>
            <span class="c"># get area</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">areas</span>
            <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">num</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Unknown item! Please pass the name of a point, line or area!&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FeaModel.MatlMaker"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.MatlMaker">[docs]</a>    <span class="k">def</span> <span class="nf">MatlMaker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">Material</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mat</span>
</div>
<div class="viewcode-block" id="FeaModel.PartMaker"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.PartMaker">[docs]</a>    <span class="k">def</span> <span class="nf">PartMaker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">Part</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p</span>
</div>
<div class="viewcode-block" id="FeaModel.ModelMaker"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.ModelMaker">[docs]</a>    <span class="k">def</span> <span class="nf">ModelMaker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parts</span><span class="p">,</span> <span class="n">mtype</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parts</span><span class="p">,</span> <span class="n">mtype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">m</span>    
</div>
<div class="viewcode-block" id="FeaModel.plot_elements"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.plot_elements">[docs]</a>    <span class="k">def</span> <span class="nf">plot_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">enum</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">nnum</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="c"># plots the elements in the part</span>

        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">items</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># use selected set</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;selected&#39;</span><span class="p">]</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;elements&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># used passed items</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listify</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                <span class="n">nodes</span> <span class="o">+=</span> <span class="n">i</span><span class="o">.</span><span class="n">nodes</span>
                <span class="n">elements</span> <span class="o">+=</span> <span class="n">i</span><span class="o">.</span><span class="n">elements</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                
            <span class="n">radials</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
            <span class="n">axials</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">y</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
            <span class="n">vadder</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">radials</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">radials</span><span class="p">))</span><span class="o">/</span><span class="mi">5</span>
            <span class="n">hadder</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">axials</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">axials</span><span class="p">))</span><span class="o">/</span><span class="mi">5</span>
    
            <span class="p">(</span><span class="n">vmax</span><span class="p">,</span><span class="n">vmin</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">radials</span><span class="p">)</span><span class="o">+</span><span class="n">vadder</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">radials</span><span class="p">)</span><span class="o">-</span><span class="n">vadder</span><span class="p">)</span>
            <span class="p">(</span><span class="n">hmax</span><span class="p">,</span><span class="n">hmin</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">axials</span><span class="p">)</span><span class="o">+</span><span class="n">hadder</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">axials</span><span class="p">)</span><span class="o">-</span><span class="n">hadder</span><span class="p">)</span>
        
            <span class="c"># plotting elements</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>            
            <span class="n">patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
                <span class="n">xycoords</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">get_corner_nodes</span><span class="p">()</span>
                <span class="n">polygon</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">xycoords</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="n">patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">PatchCollection</span><span class="p">(</span><span class="n">patches</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="n">_fcolor</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="n">_ecolor</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            
            <span class="c"># add element numbers</span>
            <span class="k">if</span> <span class="n">enum</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
                    <span class="p">[</span><span class="n">ename</span><span class="p">,</span> <span class="n">pax</span><span class="p">,</span> <span class="n">prad</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="n">e</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">x</span><span class="p">]</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">ename</span><span class="p">,</span> <span class="p">(</span><span class="n">pax</span><span class="p">,</span><span class="n">prad</span><span class="p">))</span>

            <span class="c"># add element numbers</span>
            <span class="k">if</span> <span class="n">nnum</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                    <span class="p">[</span><span class="n">nname</span><span class="p">,</span> <span class="n">pax</span><span class="p">,</span> <span class="n">prad</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="n">n</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">x</span><span class="p">]</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">nname</span><span class="p">,</span> <span class="p">(</span><span class="n">pax</span><span class="p">,</span><span class="n">prad</span><span class="p">))</span>

            
            <span class="c"># set units</span>
            <span class="p">[</span><span class="n">d_unit</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_units</span><span class="p">(</span><span class="s">&#39;dist&#39;</span><span class="p">)</span>            
            
            <span class="n">iname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cname</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">iname</span><span class="o">+</span><span class="s">&#39; elements&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;axial, y&#39;</span><span class="o">+</span><span class="n">d_unit</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;radial, x&#39;</span><span class="o">+</span><span class="n">d_unit</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;scaled&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">hmin</span><span class="p">,</span> <span class="n">hmax</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">fname</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="c"># save the image</span>
                <span class="n">fname</span> <span class="o">+=</span> <span class="s">&#39;.png&#39;</span>
                <span class="k">if</span> <span class="n">environment</span><span class="o">.</span><span class="n">DPI</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">environment</span><span class="o">.</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s">&#39;tight&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s">&#39;tight&#39;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>        

            <span class="c"># remove all figures</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c"># part has not been meshed yet</span>
            <span class="n">res</span> <span class="o">=</span> <span class="s">&#39;No elements exist! &#39;</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="s">&#39;Try meshing your parts. &#39;</span> 
            <span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FeaModel.plot_pressures"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.plot_pressures">[docs]</a>    <span class="k">def</span> <span class="nf">plot_pressures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">items</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="c"># plot the pressures on elements</span>

        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">items</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># use selected set</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;selected&#39;</span><span class="p">]</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;elements&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># use passed item</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listify</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                <span class="n">nodes</span> <span class="o">+=</span> <span class="n">i</span><span class="o">.</span><span class="n">nodes</span>
                <span class="n">elements</span> <span class="o">+=</span> <span class="n">i</span><span class="o">.</span><span class="n">elements</span>
        
        <span class="c"># plot all elements and store length, length determins min pressure arrow</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            
            <span class="c"># get axials and radials for bounds</span>
            <span class="n">radials</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
            <span class="n">axials</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
            
            <span class="c"># plotting elements</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>

            <span class="n">patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">face_len</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
                <span class="n">face_len</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">e</span><span class="o">.</span><span class="n">face</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="p">)</span>
                <span class="n">xycoords</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">get_corner_nodes</span><span class="p">()</span>
                <span class="n">polygon</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">xycoords</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="n">patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">PatchCollection</span><span class="p">(</span><span class="n">patches</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="n">_ecolor</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="n">_fcolor</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                        
            <span class="c"># average face length is min arrow length</span>
            <span class="n">face_len</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">face_len</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">face_len</span><span class="p">)</span>            

            <span class="c"># store pressures we&#39;ll want to plot</span>
            <span class="c"># this is a list of lists [face, pval]</span>
            <span class="n">plist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">load</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">load</span><span class="o">.</span><span class="n">ltype</span> <span class="ow">in</span>  <span class="p">[</span><span class="s">&#39;press&#39;</span><span class="p">,</span><span class="s">&#39;press_fluid&#39;</span><span class="p">]:</span>
                    <span class="n">plist</span> <span class="o">+=</span> <span class="n">load</span><span class="o">.</span><span class="n">get_list</span><span class="p">()</span>
            <span class="n">pressures</span> <span class="o">=</span> <span class="p">[</span><span class="n">pval</span> <span class="k">for</span> <span class="p">[</span><span class="n">face</span><span class="p">,</span><span class="n">pval</span><span class="p">]</span> <span class="ow">in</span> <span class="n">plist</span><span class="p">]</span>

            <span class="c"># check min and max bounds</span>
            <span class="n">pmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">pressures</span><span class="p">)</span>
            <span class="n">pmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">pressures</span><span class="p">)</span>
            <span class="n">mult</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">pmin</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">mult</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mult</span> <span class="o">=</span> <span class="n">face_len</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">pmin</span><span class="p">)</span>    <span class="c"># mult to go from pressure to length</span>
            
            <span class="c"># make tick list for later plot, and color map</span>
            <span class="n">tick_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">pmin</span><span class="p">]</span>  <span class="c"># default to plot one val</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">([</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">])</span> <span class="c"># default to plot one val</span>
            <span class="k">if</span> <span class="n">pmax</span> <span class="o">!=</span> <span class="n">pmin</span><span class="p">:</span>
                <span class="c"># we have a range of values we&#39;re plotting</span>
                <span class="n">tick_list</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">pmin</span><span class="p">,</span><span class="n">pmax</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
                <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span>
                        
            <span class="c"># set color contours for arrows</span>
            <span class="n">cNorm</span>  <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">pmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">pmax</span><span class="p">)</span>
            <span class="n">scalarMap</span> <span class="o">=</span> <span class="n">cmx</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">cNorm</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>            
            <span class="n">scalarMap</span><span class="o">.</span><span class="n">_A</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># need to set this for it to work</span>
            
            <span class="c"># make arrows</span>
            <span class="k">for</span> <span class="p">[</span><span class="n">face</span><span class="p">,</span> <span class="n">pval</span><span class="p">]</span> <span class="ow">in</span> <span class="n">plist</span><span class="p">:</span>
                <span class="p">[</span><span class="n">p1</span><span class="p">,</span> <span class="n">unit</span><span class="p">]</span> <span class="o">=</span> <span class="n">face</span><span class="o">.</span><span class="n">get_mnorm</span><span class="p">()</span>
                <span class="n">pdelta</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">if</span> <span class="n">pmin</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">pdelta</span> <span class="o">=</span> <span class="n">unit</span><span class="o">*</span><span class="n">face_len</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pdelta</span> <span class="o">=</span> <span class="n">unit</span><span class="o">*</span><span class="p">(</span><span class="n">mult</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">pval</span><span class="p">))</span>
                <span class="n">p2</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">+</span> <span class="n">pdelta</span>
                
                <span class="c"># assuming positive pressure, arrow points to face p2-&gt;p1</span>
                <span class="n">pstart</span> <span class="o">=</span> <span class="n">p2</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">p2</span>
                <span class="k">if</span> <span class="n">pval</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">pstart</span> <span class="o">=</span> <span class="n">p1</span>
                    <span class="n">delta</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p1</span>                    
                <span class="n">radials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p2</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
                <span class="n">axials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p2</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

                <span class="n">hw</span> <span class="o">=</span> <span class="n">face_len</span><span class="o">*</span><span class="mf">0.2</span>
                <span class="n">hl</span> <span class="o">=</span> <span class="n">face_len</span><span class="o">*</span><span class="mf">0.3</span>
                <span class="n">colorVal</span> <span class="o">=</span> <span class="n">scalarMap</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">pval</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">pstart</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>  <span class="c">#x1</span>
                          <span class="n">pstart</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>  <span class="c"># y1</span>
                          <span class="n">delta</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="c"># x2 - x1</span>
                          <span class="n">delta</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="c"># y2 - y1</span>
                          <span class="n">color</span><span class="o">=</span><span class="n">colorVal</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="n">hw</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="n">hl</span><span class="p">,</span>
                          <span class="n">length_includes_head</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>                
                            
            <span class="c"># set the horizontal and vertical axes</span>
            <span class="n">vert</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">radials</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">radials</span><span class="p">)</span>
            <span class="n">horiz</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">axials</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">axials</span><span class="p">)</span>
            <span class="n">vadder</span> <span class="o">=</span> <span class="p">(</span><span class="n">vert</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span>
            <span class="n">hadder</span> <span class="o">=</span> <span class="p">(</span><span class="n">horiz</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span>    
            <span class="p">(</span><span class="n">vmax</span><span class="p">,</span><span class="n">vmin</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">radials</span><span class="p">)</span><span class="o">+</span><span class="n">vadder</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">radials</span><span class="p">)</span><span class="o">-</span><span class="n">vadder</span><span class="p">)</span>
            <span class="p">(</span><span class="n">hmax</span><span class="p">,</span><span class="n">hmin</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">axials</span><span class="p">)</span><span class="o">+</span><span class="n">hadder</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">axials</span><span class="p">)</span><span class="o">-</span><span class="n">hadder</span><span class="p">)</span>

            <span class="c"># set units</span>
            <span class="p">[</span><span class="n">d_unit</span><span class="p">,</span> <span class="n">p_unit</span><span class="p">,</span> <span class="n">t_unit</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_units</span><span class="p">(</span><span class="s">&#39;dist&#39;</span><span class="p">,</span> <span class="s">&#39;stress&#39;</span><span class="p">,</span> <span class="s">&#39;time&#39;</span><span class="p">)</span>

            <span class="c"># set plot axes</span>
            <span class="n">iname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cname</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
            <span class="n">tstr</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> pressures </span><span class="si">%s</span><span class="se">\n</span><span class="s">Time=</span><span class="si">%f%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">iname</span><span class="p">,</span> <span class="n">p_unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                                                 <span class="n">t_unit</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">tstr</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;axial, y&#39;</span><span class="o">+</span><span class="n">d_unit</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;radial, x&#39;</span><span class="o">+</span><span class="n">d_unit</span><span class="p">)</span>

            <span class="c"># set min and max vertical and axial limits</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">hmin</span><span class="p">,</span> <span class="n">hmax</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>            
            
            <span class="c"># set the colorbar</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scalarMap</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">tick_list</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">fname</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="c"># save the image</span>
                <span class="n">fname</span> <span class="o">+=</span> <span class="s">&#39;.png&#39;</span>
                <span class="k">if</span> <span class="n">environment</span><span class="o">.</span><span class="n">DPI</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">environment</span><span class="o">.</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s">&#39;tight&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s">&#39;tight&#39;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>        

            <span class="c"># remove all figures</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c"># part has not been meshed yet</span>
            <span class="n">res</span> <span class="o">=</span> <span class="s">&#39;Part: </span><span class="si">%s</span><span class="s"> does not have any elements! &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="s">&#39;Try meshing it with model.mesh(1)&#39;</span> 
            <span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FeaModel.plot_constraints"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.plot_constraints">[docs]</a>    <span class="k">def</span> <span class="nf">plot_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">items</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="c"># this plots the constraints on the passed part or selected items</span>

        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">items</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># use selected set</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;selected&#39;</span><span class="p">]</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;elements&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># use passed item</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listify</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                <span class="n">nodes</span> <span class="o">+=</span> <span class="n">i</span><span class="o">.</span><span class="n">nodes</span>
                <span class="n">elements</span> <span class="o">+=</span> <span class="n">i</span><span class="o">.</span><span class="n">elements</span>
        
        <span class="c"># plot all elements</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            
            <span class="c"># get axials and radials for bounds</span>
            <span class="n">radials</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
            <span class="n">axials</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
            
            <span class="c"># plotting elements</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>

            <span class="n">patches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">face_len</span> <span class="o">=</span> <span class="p">[]</span>            
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
                <span class="n">face_len</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">e</span><span class="o">.</span><span class="n">face</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="p">)</span>                
                <span class="n">xycoords</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">get_corner_nodes</span><span class="p">()</span>
                <span class="n">polygon</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">xycoords</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="n">patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">PatchCollection</span><span class="p">(</span><span class="n">patches</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="n">_ecolor</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="n">_fcolor</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

            <span class="c"># average face length is min arrow length</span>
            <span class="n">face_len</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">face_len</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">face_len</span><span class="p">)</span>

            <span class="c"># store displacements we&#39;ll plot</span>
            <span class="c"># this is a list of lists [node, dict ux,uy,uz]</span>
            <span class="n">ulist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">load</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">load</span><span class="o">.</span><span class="n">ltype</span> <span class="ow">in</span>  <span class="p">[</span><span class="s">&#39;ux&#39;</span><span class="p">,</span><span class="s">&#39;uy&#39;</span><span class="p">,</span><span class="s">&#39;uz&#39;</span><span class="p">]:</span>
                    <span class="n">ulist</span> <span class="o">+=</span> <span class="n">load</span><span class="o">.</span><span class="n">get_list</span><span class="p">()</span>
                    <span class="c"># still need to filter out items not in our selection set</span>
                    <span class="k">for</span> <span class="n">udisp</span> <span class="ow">in</span> <span class="n">ulist</span><span class="p">:</span>
                        <span class="n">vals</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">udisp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="p">)</span>

            <span class="c"># check min and max bounds</span>
            <span class="n">pmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
            <span class="n">pmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
            
            <span class="c"># make tick list for later plot, and color map</span>
            <span class="n">tick_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">pmin</span><span class="p">]</span>  <span class="c"># default to plot one val</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">([</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">])</span> <span class="c"># default to plot one val</span>
            <span class="k">if</span> <span class="n">pmax</span> <span class="o">!=</span> <span class="n">pmin</span><span class="p">:</span>
                <span class="c"># we have a range of values we&#39;re plotting</span>
                <span class="n">tick_list</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">pmin</span><span class="p">,</span><span class="n">pmax</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
                <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span>
                        
            <span class="c"># set color contours for arrows</span>
            <span class="n">cNorm</span>  <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">pmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">pmax</span><span class="p">)</span>
            <span class="n">scalarMap</span> <span class="o">=</span> <span class="n">cmx</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">cNorm</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>            
            <span class="n">scalarMap</span><span class="o">.</span><span class="n">_A</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># need to set this for it to work</span>
            
            <span class="c"># make arrows for displacements</span>
            <span class="n">pvect</span><span class="o">=</span> <span class="p">{</span><span class="s">&#39;ux&#39;</span><span class="p">:</span><span class="n">geometry</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                    <span class="s">&#39;uy&#39;</span><span class="p">:</span><span class="n">geometry</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                    <span class="s">&#39;uz&#39;</span><span class="p">:</span><span class="n">geometry</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)}</span>
            <span class="k">for</span> <span class="p">[</span><span class="n">node</span><span class="p">,</span> <span class="n">udict</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ulist</span><span class="p">:</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">udict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">delta</span> <span class="o">=</span> <span class="n">pvect</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="n">pstart</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
                    <span class="n">pend</span> <span class="o">=</span> <span class="n">pstart</span> <span class="o">+</span> <span class="n">delta</span><span class="o">*</span><span class="n">v</span>
                    <span class="n">hw</span> <span class="o">=</span> <span class="n">face_len</span><span class="o">*</span><span class="mf">0.4</span>
                    <span class="n">hl</span> <span class="o">=</span> <span class="n">hw</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">pend</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
                        <span class="n">pstart</span> <span class="o">=</span> <span class="n">pend</span> <span class="o">-</span> <span class="n">delta</span><span class="o">*</span><span class="p">(</span><span class="n">hl</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
                        <span class="c">#radials.append(pstart.x)</span>
                        <span class="c">#axials.append(pstart.y)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c">#radials.append(pend.x)</span>
                        <span class="c">#axials.append(pend.y)</span>
                        <span class="k">pass</span>
                
                    <span class="n">delta</span> <span class="o">=</span> <span class="n">pend</span> <span class="o">-</span> <span class="n">pstart</span>
                    <span class="n">colorVal</span> <span class="o">=</span> <span class="n">scalarMap</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">pstart</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>  <span class="c">#x1</span>
                              <span class="n">pstart</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>  <span class="c"># y1</span>
                              <span class="n">delta</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="c"># x2 - x1</span>
                              <span class="n">delta</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="c"># y2 - y1</span>
                              <span class="n">color</span><span class="o">=</span><span class="n">colorVal</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="n">hw</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="n">hl</span><span class="p">,</span>
                              <span class="n">length_includes_head</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>                
                            
            <span class="c"># set the horizontal and vertical axes</span>
            <span class="n">vert</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">radials</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">radials</span><span class="p">)</span>
            <span class="n">horiz</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">axials</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">axials</span><span class="p">)</span>
            <span class="n">vadder</span> <span class="o">=</span> <span class="p">(</span><span class="n">vert</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span>
            <span class="n">hadder</span> <span class="o">=</span> <span class="p">(</span><span class="n">horiz</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span>    
            <span class="p">(</span><span class="n">vmax</span><span class="p">,</span><span class="n">vmin</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">radials</span><span class="p">)</span><span class="o">+</span><span class="n">vadder</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">radials</span><span class="p">)</span><span class="o">-</span><span class="n">vadder</span><span class="p">)</span>
            <span class="p">(</span><span class="n">hmax</span><span class="p">,</span><span class="n">hmin</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">axials</span><span class="p">)</span><span class="o">+</span><span class="n">hadder</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">axials</span><span class="p">)</span><span class="o">-</span><span class="n">hadder</span><span class="p">)</span>

            <span class="c"># set units</span>
            <span class="p">[</span><span class="n">d_unit</span><span class="p">,</span> <span class="n">t_unit</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_units</span><span class="p">(</span><span class="s">&#39;dist&#39;</span><span class="p">,</span> <span class="s">&#39;time&#39;</span><span class="p">)</span>

            <span class="c"># set plot axes</span>
            <span class="n">iname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cname</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
            <span class="n">tstr</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> constraints </span><span class="si">%s</span><span class="se">\n</span><span class="s">Time=</span><span class="si">%f%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">iname</span><span class="p">,</span> <span class="n">d_unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                                                 <span class="n">t_unit</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">tstr</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;axial, y&#39;</span><span class="o">+</span><span class="n">d_unit</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;radial, x&#39;</span><span class="o">+</span><span class="n">d_unit</span><span class="p">)</span>

            <span class="c"># set min and max vertical and axial limits</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">hmin</span><span class="p">,</span> <span class="n">hmax</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>            
            
            <span class="c"># set the colorbar</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scalarMap</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">tick_list</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">fname</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="c"># save the image</span>
                <span class="n">fname</span> <span class="o">+=</span> <span class="s">&#39;.png&#39;</span>
                <span class="k">if</span> <span class="n">environment</span><span class="o">.</span><span class="n">DPI</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">environment</span><span class="o">.</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s">&#39;tight&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s">&#39;tight&#39;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>        

            <span class="c"># remove all figures</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c"># part has not been meshed yet</span>
            <span class="n">res</span> <span class="o">=</span> <span class="s">&#39;Part: </span><span class="si">%s</span><span class="s"> does not have any elements! &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="s">&#39;Try meshing it with model.mesh(1)&#39;</span> 
            <span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FeaModel.plot_geometry"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.plot_geometry">[docs]</a>    <span class="k">def</span> <span class="nf">plot_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">items</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="c"># this method plots the part</span>
        <span class="c"># check out: http://nickcharlton.net/posts/drawing-animating-shapes-matplotlib.html</span>

        <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">areas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">items</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># use selected set</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;selected&#39;</span><span class="p">]</span>
            <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;points&#39;</span><span class="p">]</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;lines&#39;</span><span class="p">]</span>
            <span class="n">areas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">[</span><span class="s">&#39;areas&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listify</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">part</span><span class="o">.</span><span class="n">Part</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                    <span class="n">points</span> <span class="o">+=</span> <span class="n">i</span><span class="o">.</span><span class="n">get_points</span><span class="p">()</span>
                    <span class="n">lines</span> <span class="o">+=</span> <span class="n">i</span><span class="o">.</span><span class="n">get_lines</span><span class="p">()</span>
                    <span class="n">areas</span> <span class="o">+=</span> <span class="n">i</span><span class="o">.</span><span class="n">areas</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">geometry</span><span class="o">.</span><span class="n">Area</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                    <span class="n">points</span> <span class="o">+=</span> <span class="n">i</span><span class="o">.</span><span class="n">get_points</span><span class="p">()</span>
                    <span class="n">lines</span> <span class="o">+=</span> <span class="n">i</span><span class="o">.</span><span class="n">lines</span>
                    <span class="n">areas</span> <span class="o">+=</span> <span class="n">i</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">geometry</span><span class="o">.</span><span class="n">Line</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                    <span class="n">points</span> <span class="o">+=</span> <span class="n">i</span><span class="o">.</span><span class="n">_points_</span>
                    <span class="n">lines</span> <span class="o">+=</span> <span class="n">i</span>                
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">geometry</span><span class="o">.</span><span class="n">Point</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                    <span class="n">points</span> <span class="o">+=</span> <span class="n">i</span>
        
        <span class="n">nax</span><span class="o">=</span><span class="p">[</span><span class="n">pt</span><span class="o">.</span><span class="n">y</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>
        <span class="n">nrad</span><span class="o">=</span><span class="p">[</span><span class="n">pt</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>
        <span class="n">n_id</span><span class="o">=</span><span class="p">[</span><span class="n">pt</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>
        
        <span class="c"># need to go through lines making list of points, don&#39;t have to be</span>
        <span class="c"># sequential</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        
        <span class="c">#fig, ax = plt.subplots()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">nax</span><span class="p">,</span> <span class="n">nrad</span><span class="p">)</span>
        
        <span class="c"># plot points</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">txt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">n_id</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="p">(</span><span class="n">nax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">nrad</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        
        <span class="c">#plot lines</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        
        <span class="c">#plot area ids</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">areas</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">closed</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">pax</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">y</span>
                <span class="n">prad</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">x</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="p">(</span><span class="n">pax</span><span class="p">,</span><span class="n">prad</span><span class="p">))</span>

        <span class="c"># set the horizontal and vertical axes</span>
        <span class="n">vert</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nrad</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">nrad</span><span class="p">)</span>
        <span class="n">horiz</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nax</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">nax</span><span class="p">)</span>
        <span class="n">vadder</span> <span class="o">=</span> <span class="p">(</span><span class="n">vert</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span>
        <span class="n">hadder</span> <span class="o">=</span> <span class="p">(</span><span class="n">horiz</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span>
        <span class="p">(</span><span class="n">vmax</span><span class="p">,</span><span class="n">vmin</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">nrad</span><span class="p">)</span><span class="o">+</span><span class="n">vadder</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">nrad</span><span class="p">)</span><span class="o">-</span><span class="n">vadder</span><span class="p">)</span>
        <span class="p">(</span><span class="n">hmax</span><span class="p">,</span><span class="n">hmin</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">nax</span><span class="p">)</span><span class="o">+</span><span class="n">hadder</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">nax</span><span class="p">)</span><span class="o">-</span><span class="n">hadder</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">hmin</span><span class="p">,</span> <span class="n">hmax</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>

        <span class="c"># set units</span>
        <span class="p">[</span><span class="n">d_unit</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_units</span><span class="p">(</span><span class="s">&#39;dist&#39;</span><span class="p">)</span>            
        
        <span class="c"># show plot</span>
        <span class="n">iname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cname</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">iname</span><span class="o">+</span><span class="s">&#39; geometry&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;axial, y&#39;</span><span class="o">+</span><span class="n">d_unit</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;radial, x&#39;</span><span class="o">+</span><span class="n">d_unit</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fname</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="c"># save the image</span>
            <span class="n">fname</span> <span class="o">+=</span> <span class="s">&#39;.png&#39;</span>
            <span class="k">if</span> <span class="n">environment</span><span class="o">.</span><span class="n">DPI</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">environment</span><span class="o">.</span><span class="n">DPI</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s">&#39;tight&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s">&#39;tight&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="c"># remove all figures</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    </div>
<div class="viewcode-block" id="FeaModel.listify"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.listify">[docs]</a>    <span class="k">def</span> <span class="nf">listify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="c"># converts item into a list if it&#39;s not one</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">items</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">items</span>
    </div>
<div class="viewcode-block" id="FeaModel.get_cname"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.get_cname">[docs]</a>    <span class="k">def</span> <span class="nf">get_cname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="c"># this returns a component name prefix, for labeling lists of items</span>
        <span class="n">cname</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;all&#39;</span><span class="p">:</span>
                <span class="n">cname</span> <span class="o">=</span> <span class="s">&#39;all&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cname</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cname</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span><span class="o">+</span><span class="s">&#39;-&#39;</span><span class="o">+</span><span class="n">items</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">cname</span>
</div>
<div class="viewcode-block" id="FeaModel.add_load"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.add_load">[docs]</a>    <span class="k">def</span> <span class="nf">add_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">load</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="c"># add load to feamodel and part</span>
        <span class="k">if</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">load</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">[</span><span class="n">time</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">load</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="FeaModel.set_gravity"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.set_gravity">[docs]</a>    <span class="k">def</span> <span class="nf">set_gravity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grav</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="c"># applies gravity to the items</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listify</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="n">ctype</span> <span class="o">=</span> <span class="s">&#39;elements&#39;</span>        
        <span class="n">cname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cname</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">cname</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">comp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>
        
        <span class="n">ltype</span> <span class="o">=</span> <span class="s">&#39;gravity&#39;</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
        <span class="n">load</span> <span class="o">=</span> <span class="n">loads</span><span class="o">.</span><span class="n">Load</span><span class="p">(</span><span class="n">ltype</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">grav</span><span class="p">)</span>
        
        <span class="c"># add load to feamodel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_load</span><span class="p">(</span><span class="n">load</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FeaModel.set_rpm"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.set_rpm">[docs]</a>    <span class="k">def</span> <span class="nf">set_rpm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rpm</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="c"># applies rpm to the items</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listify</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="n">ctype</span> <span class="o">=</span> <span class="s">&#39;elements&#39;</span>
        <span class="n">cname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cname</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">cname</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">comp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>
        
        <span class="n">ltype</span> <span class="o">=</span> <span class="s">&#39;rpm&#39;</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
        <span class="n">load</span> <span class="o">=</span> <span class="n">loads</span><span class="o">.</span><span class="n">Load</span><span class="p">(</span><span class="n">ltype</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">rpm</span><span class="p">)</span>
        
        <span class="c"># add load to feamodel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_load</span><span class="p">(</span><span class="n">load</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FeaModel.set_radps"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.set_radps">[docs]</a>    <span class="k">def</span> <span class="nf">set_radps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rpm</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="c"># applies radps to the items</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listify</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="n">ctype</span> <span class="o">=</span> <span class="s">&#39;elements&#39;</span>
        <span class="n">cname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cname</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">cname</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">comp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>
        
        <span class="n">ltype</span> <span class="o">=</span> <span class="s">&#39;radps&#39;</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
        <span class="n">load</span> <span class="o">=</span> <span class="n">loads</span><span class="o">.</span><span class="n">Load</span><span class="p">(</span><span class="n">ltype</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">rpm</span><span class="p">)</span>
        
        <span class="c"># add load to feamodel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_load</span><span class="p">(</span><span class="n">load</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="FeaModel.set_fluid_press"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.set_fluid_press">[docs]</a>    <span class="k">def</span> <span class="nf">set_fluid_press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">str_items</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">xo</span><span class="p">,</span> <span class="n">po</span><span class="p">):</span>
        <span class="c"># this sets pressure from water + atmosphere</span>
        <span class="c"># p = po + rho*g*h, it assumes pressure increases in -x</span>

        <span class="n">items</span> <span class="o">=</span> <span class="n">str_items</span>
        <span class="c"># convert string into item(self)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">str_items</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="n">str_items</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listify</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

        <span class="n">ctype</span> <span class="o">=</span> <span class="s">&#39;faces&#39;</span>
        <span class="n">cname</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cname</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">cname</span><span class="p">)</span>
        
        <span class="n">ltype</span> <span class="o">=</span> <span class="s">&#39;press_fluid&#39;</span>
        <span class="n">mult</span> <span class="o">=</span> <span class="n">rho</span><span class="o">*</span><span class="n">g</span>
        <span class="n">load</span> <span class="o">=</span> <span class="n">loads</span><span class="o">.</span><span class="n">Load_linear</span><span class="p">(</span><span class="n">ltype</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">po</span><span class="p">,</span> <span class="n">mult</span><span class="p">,</span> <span class="n">xo</span><span class="p">)</span>
        
        <span class="c"># add load to feamodel and part</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_load</span><span class="p">(</span><span class="n">load</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>            
</div>
<div class="viewcode-block" id="FeaModel.set_load"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.set_load">[docs]</a>    <span class="k">def</span> <span class="nf">set_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ltype</span><span class="p">,</span> <span class="n">str_items</span><span class="p">,</span> <span class="n">lval</span><span class="p">,</span> <span class="n">ldir</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># applies a load or pressure to lines</span>
        <span class="c"># ltype = &#39;press&#39; or &#39;force&#39;</span>
        <span class="c"># str_items is a string defining a line, point or side of the part</span>
        <span class="c">#    or an item or a list of items</span>
        <span class="c"># ldir = &#39;x&#39; or &#39;y&#39; or &#39;z&#39;</span>
        <span class="c"># positive pressure sign is compressing the surface</span>
        <span class="c"># this is used to apply them to the child nodes/faces</span>
        
        <span class="c"># make component if it doesn&#39;t exist</span>
        
        <span class="c"># convert string into item(self)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">str_items</span>
        <span class="c"># convert string into item(self)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">str_items</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="n">str_items</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listify</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        
        <span class="n">ctype</span> <span class="o">=</span> <span class="s">&#39;nodes&#39;</span>
        <span class="k">if</span> <span class="n">ltype</span> <span class="o">==</span> <span class="s">&#39;press&#39;</span><span class="p">:</span>
            <span class="n">ctype</span> <span class="o">=</span> <span class="s">&#39;faces&#39;</span>
        <span class="n">cname</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cname</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">cname</span><span class="p">)</span>
        
        <span class="c"># check if component exists, and if so use it, need to write it here</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ltype</span> <span class="o">==</span> <span class="s">&#39;force&#39;</span><span class="p">:</span>
            <span class="n">ltype</span> <span class="o">=</span> <span class="s">&#39;f&#39;</span><span class="o">+</span><span class="n">ldir</span> <span class="c"># for example fx</span>

        <span class="c"># add load to feamodel</span>
        <span class="n">load</span> <span class="o">=</span> <span class="n">loads</span><span class="o">.</span><span class="n">Load</span><span class="p">(</span><span class="n">ltype</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">lval</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_load</span><span class="p">(</span><span class="n">load</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FeaModel.set_constr"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.set_constr">[docs]</a>    <span class="k">def</span> <span class="nf">set_constr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ltype</span><span class="p">,</span> <span class="n">line_list</span><span class="p">,</span> <span class="n">ldir</span><span class="p">,</span> <span class="n">lval</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="c"># this sets constraints on lines</span>
        <span class="c"># ltype = &#39;fix&#39; or &#39;displ&#39;</span>
        <span class="c"># ldir = &#39;x&#39; or &#39;y&#39; or &#39;z&#39;</span>
        <span class="n">ctype</span> <span class="o">=</span> <span class="s">&#39;nodes&#39;</span>

        <span class="c"># convert string into item(s)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line_list</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">line_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="n">line_list</span><span class="p">)</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listify</span><span class="p">(</span><span class="n">line_list</span><span class="p">)</span>

        <span class="n">cname</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cname</span><span class="p">(</span><span class="n">line_list</span><span class="p">)</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="n">line_list</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">cname</span><span class="p">)</span>

        <span class="c"># check if component exists, and if so use it, need to write it here</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>

        <span class="n">ltype</span> <span class="o">=</span> <span class="s">&#39;u&#39;</span><span class="o">+</span><span class="n">ldir</span> <span class="c"># for example ux</span>
        <span class="n">load</span> <span class="o">=</span> <span class="n">loads</span><span class="o">.</span><span class="n">Load</span><span class="p">(</span><span class="n">ltype</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">lval</span><span class="p">)</span>

        <span class="c"># add load to feamodel and part</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_load</span><span class="p">(</span><span class="n">load</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FeaModel.set_eshape"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.set_eshape">[docs]</a>    <span class="k">def</span> <span class="nf">set_eshape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eshape</span><span class="o">=</span><span class="s">&#39;quad&#39;</span><span class="p">,</span> <span class="n">eorder</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="c"># sets eleemnt properties and thickness if applicable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eshape</span> <span class="o">=</span> <span class="n">eshape</span> <span class="c"># quad or tri</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eorder</span> <span class="o">=</span> <span class="n">eorder</span> <span class="c"># 1 or 2</span>
</div>
<div class="viewcode-block" id="FeaModel.set_etype"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.set_etype">[docs]</a>    <span class="k">def</span> <span class="nf">set_etype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">etype</span><span class="o">=</span><span class="s">&#39;plstress&#39;</span><span class="p">,</span> <span class="n">thick</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># sets the element type on part areas, or a list of areas</span>

        <span class="c"># convert string into item(s)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

        <span class="c"># convert items into areas</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listify</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="n">cname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cname</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">part</span><span class="o">.</span><span class="n">Part</span><span class="p">):</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
                <span class="n">tmp</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">areas</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">tmp</span>

        <span class="c"># set the element types on the areas, this is used to fix</span>
        <span class="c"># elements when importing them from the inp file</span>
        <span class="k">for</span> <span class="n">area</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">area</span><span class="o">.</span><span class="n">set_etype</span><span class="p">(</span><span class="n">etype</span><span class="p">)</span>

        <span class="c"># set a thickness component if needed</span>
        <span class="k">if</span> <span class="n">etype</span> <span class="o">!=</span> <span class="s">&#39;axisym&#39;</span> <span class="ow">and</span> <span class="n">thick</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            
            <span class="c"># make component for nodal thickness</span>
            <span class="n">ctype</span> <span class="o">=</span> <span class="s">&#39;nodes&#39;</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">cname</span><span class="o">+</span><span class="s">&#39;_nodes&#39;</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">comp</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">comp</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">cname</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>            

            <span class="c"># check existing thickness components and remove new area from them</span>
            <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">load</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">[</span><span class="n">time</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">load</span><span class="o">.</span><span class="n">ltype</span> <span class="o">==</span> <span class="s">&#39;thickness&#39;</span><span class="p">:</span>
                        <span class="n">c</span> <span class="o">=</span> <span class="n">load</span><span class="o">.</span><span class="n">comp</span>
                        <span class="n">areas</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">items</span>
                        <span class="k">for</span> <span class="n">newarea</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">newarea</span> <span class="ow">in</span> <span class="n">areas</span><span class="p">:</span>
                                <span class="n">areas</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">newarea</span><span class="p">)</span>
                        <span class="c"># relabel modified component</span>
                        <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cname</span><span class="p">(</span><span class="n">areas</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;_nodes&#39;</span>                        
                        
            <span class="n">ltype</span> <span class="o">=</span> <span class="s">&#39;thickness&#39;</span>
            <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">load</span> <span class="o">=</span> <span class="n">loads</span><span class="o">.</span><span class="n">Load</span><span class="p">(</span><span class="n">ltype</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">thick</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_load</span><span class="p">(</span><span class="n">load</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FeaModel.set_matl"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.set_matl">[docs]</a>    <span class="k">def</span> <span class="nf">set_matl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matl</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="c"># sets the matl on an item, part, or area + makes a component to apply it</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listify</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="n">cname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cname</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">part</span><span class="o">.</span><span class="n">Part</span><span class="p">):</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
                <span class="n">tmp</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">areas</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">tmp</span>

        <span class="c"># set the matls on the areas</span>
        <span class="k">for</span> <span class="n">area</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">pass</span>
            <span class="c">#area.set_matl(matl)</span>

        <span class="c"># make component</span>
        <span class="n">ctype</span> <span class="o">=</span> <span class="s">&#39;elements&#39;</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">cname</span><span class="o">+</span><span class="s">&#39;_elements&#39;</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">comp</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">cname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>            

        <span class="c"># check existing matl components and remove new area from them</span>
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">load</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">[</span><span class="n">time</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">load</span><span class="o">.</span><span class="n">ltype</span> <span class="o">==</span> <span class="s">&#39;matl&#39;</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">load</span><span class="o">.</span><span class="n">comp</span>
                    <span class="n">areas</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">items</span>
                    <span class="k">for</span> <span class="n">newarea</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">newarea</span> <span class="ow">in</span> <span class="n">areas</span><span class="p">:</span>
                            <span class="n">areas</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">newarea</span><span class="p">)</span>
                    <span class="c"># relabel modified component</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cname</span><span class="p">(</span><span class="n">areas</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;_elements&#39;</span>                        
        
        <span class="c"># manually set all elments to the correct matl if they already exist</span>
        <span class="k">for</span> <span class="n">area</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="s">&#39;elements&#39;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">area</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
                    <span class="k">pass</span>
        
        <span class="n">ltype</span> <span class="o">=</span> <span class="s">&#39;matl&#39;</span>
        <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">load</span> <span class="o">=</span> <span class="n">loads</span><span class="o">.</span><span class="n">Load</span><span class="p">(</span><span class="n">ltype</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">matl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_load</span><span class="p">(</span><span class="n">load</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FeaModel.mesh"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.mesh">[docs]</a>    <span class="k">def</span> <span class="nf">mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fineness</span><span class="p">,</span> <span class="n">mesher</span><span class="o">=</span><span class="s">&#39;cgx&#39;</span><span class="p">):</span>
        <span class="c"># this initiates meshing of all parts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesher</span> <span class="o">=</span> <span class="n">mesher</span>
                
        <span class="k">if</span> <span class="n">mesher</span> <span class="o">==</span> <span class="s">&#39;gmsh&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mesh_gmsh</span><span class="p">(</span><span class="n">fineness</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mesher</span> <span class="o">==</span> <span class="s">&#39;cgx&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mesh_cgx</span><span class="p">(</span><span class="n">fineness</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FeaModel.mesh_gmsh"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.mesh_gmsh">[docs]</a>    <span class="k">def</span> <span class="nf">mesh_gmsh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fine</span><span class="p">):</span>
        <span class="c"># this meshes the model</span>
        
        <span class="n">geo</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># write all points</span>
        <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">:</span>
            <span class="n">linestr</span> <span class="o">=</span> <span class="s">&#39;Point(</span><span class="si">%i</span><span class="s">) = {</span><span class="si">%f</span><span class="s">, </span><span class="si">%f</span><span class="s">, </span><span class="si">%f</span><span class="s">};&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linestr</span><span class="p">)</span>
        
        <span class="c"># write all lines</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="n">ln</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">id</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">id</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">id</span>
            <span class="n">linestr</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">geometry</span><span class="o">.</span><span class="n">Arc</span><span class="p">):</span>
                <span class="c"># line is arc</span>
                <span class="n">pc</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">actr</span><span class="o">.</span><span class="n">id</span>
                <span class="n">linestr</span> <span class="o">=</span> <span class="s">&#39;Circle(</span><span class="si">%i</span><span class="s">) = {</span><span class="si">%i</span><span class="s">, </span><span class="si">%i</span><span class="s">, </span><span class="si">%i</span><span class="s">};&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">pc</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># straight line</span>
                <span class="n">linestr</span> <span class="o">=</span> <span class="s">&#39;Line(</span><span class="si">%i</span><span class="s">) = {</span><span class="si">%i</span><span class="s">,</span><span class="si">%i</span><span class="s">};&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linestr</span><span class="p">)</span>
            
            <span class="c"># set division if we have it</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&#39;ediv&#39;</span><span class="p">):</span>
                <span class="n">ndiv</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">ediv</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">esize</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">length</span><span class="p">()</span><span class="o">/</span><span class="n">line</span><span class="o">.</span><span class="n">ediv</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eshape</span> <span class="o">==</span> <span class="s">&#39;quad&#39;</span><span class="p">:</span>
                    <span class="n">ndiv</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">ediv</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span>
                    <span class="n">esize</span> <span class="o">=</span> <span class="n">esize</span><span class="o">*</span><span class="mi">2</span>
                    <span class="c"># this is needed because quad recombine</span>
                    <span class="c"># splits 1 element into 2</span>
                <span class="n">linestr</span> <span class="o">=</span> <span class="s">&#39;Transfinite Line{</span><span class="si">%i</span><span class="s">} = </span><span class="si">%i</span><span class="s">;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">ndiv</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;LINE ELEMENT SIZE: </span><span class="si">%f</span><span class="s">, MAKES </span><span class="si">%i</span><span class="s"> ELEMENTS&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">length</span><span class="p">()</span><span class="o">/</span><span class="n">line</span><span class="o">.</span><span class="n">ediv</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">ediv</span><span class="p">))</span>
                <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linestr</span><span class="p">)</span>
                <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Characteristic Length {</span><span class="si">%i</span><span class="s">,</span><span class="si">%i</span><span class="s">} = </span><span class="si">%f</span><span class="s">;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">esize</span><span class="p">))</span>            

        <span class="c"># write all areas</span>
        <span class="k">for</span> <span class="n">area</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">areas</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">area</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
                <span class="n">aid</span> <span class="o">=</span> <span class="n">area</span><span class="o">.</span><span class="n">id</span>
                <span class="n">aname</span> <span class="o">=</span> <span class="n">area</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
                <span class="n">linestr</span> <span class="o">=</span> <span class="s">&#39;Line Loop(</span><span class="si">%i</span><span class="s">) = &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">aid</span><span class="p">)</span>
                <span class="n">line_ids</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">area</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
                    <span class="n">char</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">sign</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">char</span> <span class="o">=</span> <span class="s">&#39;-&#39;</span>
                    <span class="n">line_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">char</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
                <span class="n">linestr</span> <span class="o">=</span> <span class="n">linestr</span> <span class="o">+</span> <span class="s">&#39;{&#39;</span><span class="o">+</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line_ids</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;};&#39;</span>
                <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linestr</span><span class="p">)</span>
                <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Plane Surface(</span><span class="si">%i</span><span class="s">) = {</span><span class="si">%i</span><span class="s">};&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">aid</span><span class="p">,</span> <span class="n">aid</span><span class="p">))</span>
                <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;Physical Surface(&#39;</span><span class="si">%s</span><span class="s">&#39;) = {</span><span class="si">%i</span><span class="s">};&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">aname</span><span class="p">,</span> <span class="n">aid</span><span class="p">))</span>

        <span class="c"># write part area components</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
            <span class="c"># make components for each part</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s">&quot;Physical Surface(&#39;</span><span class="si">%s</span><span class="s">&#39;) = &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
            <span class="n">area_ids</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">area</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">areas</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">area</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
                    <span class="n">area_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">area</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span> <span class="o">+</span> <span class="s">&#39;{&#39;</span> <span class="o">+</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">area_ids</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;};&#39;</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    
        <span class="c"># write all line componenets so we can get nodes out</span>
        <span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s">&quot;Physical Line(&#39;</span><span class="si">%s</span><span class="s">&#39;) = {</span><span class="si">%i</span><span class="s">};&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="n">L</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        
        <span class="c"># write node componenets</span>
        <span class="c"># node list is not produced by gmsh</span>
        <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">:</span>
            <span class="n">linestr</span> <span class="o">=</span> <span class="s">&quot;Physical Point(&#39;</span><span class="si">%s</span><span class="s">&#39;) = {</span><span class="si">%i</span><span class="s">};&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="n">pt</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linestr</span><span class="p">)</span>                    

        <span class="c"># set the meshing options</span>
        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Mesh.CharacteristicLengthFactor = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">fine</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;; //mesh fineness&#39;</span><span class="p">)</span>
        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Mesh.RecombinationAlgorithm = 1; //blossom&#39;</span><span class="p">)</span>
        <span class="c">#geo.append(&#39;Mesh.Lloyd = 1; //smoothing algorithm&#39;)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eshape</span> <span class="o">==</span> <span class="s">&#39;quad&#39;</span><span class="p">:</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Mesh.RecombineAll = 1; //turns on quads&#39;</span><span class="p">)</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Mesh.SubdivisionAlgorithm = 1; // quadrangles only&#39;</span><span class="p">)</span>
            <span class="c">#geo.append(&#39;Mesh.RecombinationAlgorithm = 1; //turns on blossom needed for quad&#39;)</span>

        <span class="n">eo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eorder</span>
        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Mesh.CharacteristicLengthExtendFromBoundary = 1;&#39;</span><span class="p">)</span>
        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Mesh.CharacteristicLengthMin = 0;&#39;</span><span class="p">)</span>
        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Mesh.CharacteristicLengthMax = 1e+022;&#39;</span><span class="p">)</span>
        <span class="c"># use this so small circles are meshed finely</span>
        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Mesh.CharacteristicLengthFromCurvature = 1;&#39;</span><span class="p">)</span>
        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Mesh.CharacteristicLengthFromPoints = 1;&#39;</span><span class="p">)</span>
        <span class="c">#geo.append(&#39;Mesh.Algorithm = 2; //delauny&#39;) #okay for quads</span>
        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Mesh.Algorithm = 8; //delquad = delauny for quads&#39;</span><span class="p">)</span>
        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Mesh.ElementOrder = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">eo</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;; //linear or second set here&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">eo</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Mesh.SecondOrderIncomplete=1; //req for 2nd ord, no face node&#39;</span><span class="p">)</span>
        <span class="n">geo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Mesh.SaveGroupsOfNodes = 1; // save node groups&#39;</span><span class="p">)</span>
                
        <span class="c"># write geo file to the local directory</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="o">+</span><span class="s">&#39;.geo&#39;</span>
        <span class="n">fout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="o">+</span><span class="s">&#39;.inp&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">geo</span><span class="p">:</span>
            <span class="c">#print (line)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">print</span> <span class="p">(</span><span class="s">&#39;File: &#39;</span><span class="o">+</span> <span class="n">fname</span> <span class="o">+</span> <span class="s">&#39; was written&#39;</span><span class="p">)</span>
        
        <span class="c"># run file in bg mode, -2 is 2d mesh</span>
        <span class="n">astr</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> -2 -o </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">environment</span><span class="o">.</span><span class="n">GMSH</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">astr</span><span class="p">)</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">astr</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">print</span> <span class="p">(</span><span class="s">&#39;File: &#39;</span><span class="o">+</span> <span class="n">fout</span> <span class="o">+</span> <span class="s">&#39; was written&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Meshing done!&#39;</span><span class="p">)</span>
        
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        # fix element type</span>
<span class="sd">        # define the element types, and tells the program to mesh</span>
<span class="sd">        estr = self.eshape+str(self.eorder)+self.parts[0].areas[0].etype</span>
<span class="sd">        ccxe = _ccx_elements[estr]</span>
<span class="sd">        #print(&#39;PREDICTED CCX ETYPE IS: &#39;,ccxe)</span>
<span class="sd">        </span>
<span class="sd">        # change the part elements to the right type</span>
<span class="sd">        inp = []</span>
<span class="sd">        f = open(fout,&#39;r&#39;)</span>
<span class="sd">        for line in f:</span>
<span class="sd">            if &#39;*Element, type=&#39; in line:</span>
<span class="sd">                etype = line[15:19]</span>
<span class="sd">                if &#39;CPS&#39; in etype:</span>
<span class="sd">                    # fix element type here, it will be CPS3,4,6 or 8</span>
<span class="sd">                    # replace PS with ES or AX</span>
<span class="sd">                    estr = ccxe[1:3]</span>
<span class="sd">                    line = line[:16] + estr + line[18:]</span>
<span class="sd">            line = line.strip()</span>
<span class="sd">            inp.append(line)</span>
<span class="sd">        f.close()</span>
<span class="sd">        # write fixed file</span>
<span class="sd">        f = open(fout,&#39;w&#39;)</span>
<span class="sd">        for line in inp:</span>
<span class="sd">            #print (line)</span>
<span class="sd">            f.write(line+&#39;\n&#39;)</span>
<span class="sd">        f.close()</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># write gmsh msh file</span>
        <span class="n">astr</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> -2 -o </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">environment</span><span class="o">.</span><span class="n">GMSH</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="o">+</span><span class="s">&#39;.msh&#39;</span><span class="p">)</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">astr</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">print</span> <span class="p">(</span><span class="s">&#39;File: &#39;</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="o">+</span> <span class="s">&#39;.msh was written&#39;</span><span class="p">)</span>

        <span class="c"># read in the calculix mesh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_inp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="o">+</span><span class="s">&#39;.inp&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FeaModel.read_inp"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.read_inp">[docs]</a>    <span class="k">def</span> <span class="nf">read_inp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
        <span class="c"># this function reads in the calculix input file</span>
        <span class="c"># stores all nodes, elements, and faces</span>
        <span class="c"># and assigns all element and node sets correctly</span>

        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">set_name</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">set_type</span> <span class="o">=</span> <span class="bp">None</span>
        
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># holder for nodes or elements in nsets or esets</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">Meshlist</span><span class="p">()</span> <span class="c"># store nodes        </span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">base_classes</span><span class="o">.</span><span class="n">Meshlist</span><span class="p">()</span> <span class="c"># store elements, allows renumbering before putting int model</span>
        <span class="n">F</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># store faces</span>
        <span class="n">sets</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;E&#39;</span><span class="p">:{},</span><span class="s">&#39;N&#39;</span><span class="p">:{}}</span> <span class="c"># store sets</span>
        <span class="n">etype</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        
        <span class="c"># read in input file</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;*&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;nmake&#39;</span><span class="p">:</span>
                    <span class="n">L</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
                    <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">L</span><span class="p">]</span>
                    <span class="p">(</span><span class="n">nnum</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
                    <span class="n">node</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">nnum</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
                    <span class="n">N</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;emake&#39;</span><span class="p">:</span>
                    <span class="n">L</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
                    <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">L</span><span class="p">]</span>
                    <span class="n">enum</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">nlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">N</span><span class="o">.</span><span class="n">idget</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="n">enum</span><span class="p">,</span> <span class="n">etype</span><span class="p">,</span> <span class="n">nlist</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nlist</span><span class="p">:</span>
                        <span class="n">n</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="n">faces</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">faces</span><span class="p">()</span>
                    <span class="n">E</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="n">F</span> <span class="o">+=</span> <span class="n">faces</span>
                    <span class="n">sets</span><span class="p">[</span><span class="n">set_type</span><span class="p">][</span><span class="n">set_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;set&#39;</span><span class="p">:</span>
                    <span class="n">L</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
                    <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">L</span><span class="p">]</span>
                    <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">L</span> <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">]</span>
                    <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">set_type</span> <span class="o">==</span> <span class="s">&#39;E&#39;</span><span class="p">:</span>
                        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">E</span><span class="o">.</span><span class="n">idget</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">L</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">set_type</span> <span class="o">==</span> <span class="s">&#39;N&#39;</span><span class="p">:</span>
                        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">N</span><span class="o">.</span><span class="n">idget</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">L</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">items</span> <span class="o">==</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
                        <span class="k">pass</span> <span class="c"># the elements were not found</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sets</span><span class="p">[</span><span class="n">set_type</span><span class="p">][</span><span class="n">set_name</span><span class="p">]</span> <span class="o">+=</span> <span class="n">items</span>
                    
            <span class="c"># mode setting</span>
            <span class="k">if</span> <span class="s">&#39;*Node&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">or</span> <span class="s">&#39;*NODE&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;nmake&#39;</span>
            <span class="k">elif</span> <span class="s">&#39;*Element&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">or</span> <span class="s">&#39;*ELEMENT&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">L</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span> <span class="c"># split it based on commas</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>
                <span class="n">etype</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                
                <span class="c"># exclude T elements made in gmsh</span>
                <span class="k">if</span> <span class="n">etype</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;T&#39;</span><span class="p">:</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>
                    <span class="n">set_name</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">set_type</span> <span class="o">=</span> <span class="s">&#39;E&#39;</span>
                    <span class="n">sets</span><span class="p">[</span><span class="n">set_type</span><span class="p">][</span><span class="n">set_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;emake&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mode</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">elif</span> <span class="s">&#39;*ELSET&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>                    
                <span class="n">L</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>
                <span class="n">set_name</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">set_type</span> <span class="o">=</span> <span class="s">&#39;E&#39;</span>
                <span class="n">sets</span><span class="p">[</span><span class="n">set_type</span><span class="p">][</span><span class="n">set_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;set&#39;</span>
            <span class="k">elif</span> <span class="s">&#39;*NSET&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>        
                <span class="n">L</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>
                <span class="n">set_name</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">set_type</span> <span class="o">=</span> <span class="s">&#39;N&#39;</span>
                <span class="n">sets</span><span class="p">[</span><span class="n">set_type</span><span class="p">][</span><span class="n">set_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;set&#39;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>        
        
        <span class="c"># loop through sets and remove empty sets</span>
        <span class="c"># store sets to delete</span>
        <span class="n">todel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">set_type</span><span class="p">,</span> <span class="n">set_dict</span><span class="p">)</span> <span class="ow">in</span> <span class="n">sets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">set_name</span><span class="p">,</span> <span class="n">item_list</span><span class="p">)</span> <span class="ow">in</span> <span class="n">set_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">item_list</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">todel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s">&#39;set_type&#39;</span><span class="p">:</span><span class="n">set_type</span><span class="p">,</span><span class="s">&#39;set_name&#39;</span><span class="p">:</span><span class="n">set_name</span><span class="p">}</span> <span class="p">)</span>
        <span class="c"># delete the empty sets</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">todel</span><span class="p">:</span>
            <span class="p">(</span><span class="n">set_type</span><span class="p">,</span> <span class="n">set_name</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;set_type&#39;</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;set_name&#39;</span><span class="p">])</span>
            <span class="k">del</span> <span class="n">sets</span><span class="p">[</span><span class="n">set_type</span><span class="p">][</span><span class="n">set_name</span><span class="p">]</span>
            <span class="c">#print(&#39;Empty set type:%s name:%s deleted&#39; % (set_type, set_name))</span>

        <span class="c"># loop through faces and set externa flag to true</span>
        <span class="n">external</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">F</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">external</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">external</span><span class="p">:</span>
            <span class="c"># set external flag to true</span>
            <span class="n">f</span><span class="o">.</span><span class="n">set_ext</span><span class="p">()</span>

        <span class="c"># this resets the min element to number 1</span>
        <span class="k">if</span> <span class="n">E</span><span class="o">.</span><span class="n">get_minid</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">E</span><span class="o">.</span><span class="n">set_minid</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c">#-----------------------------------</span>
        <span class="c"># Node and element assignment back onto parts, areas, lines, points</span>
        <span class="c">#-----------------------------------</span>
        <span class="c"># assign elements + nodes to parts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="n">E</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">faces</span> <span class="o">=</span> <span class="n">F</span>
        
        <span class="c"># remove arc center ndoes from imported node set</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">geometry</span><span class="o">.</span><span class="n">Arc</span><span class="p">):</span>                
                <span class="n">pt</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">actr</span>
                <span class="n">ndist</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">N</span><span class="p">:</span>
                    <span class="n">p_tmp</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
                    <span class="n">p_tmp</span> <span class="o">=</span> <span class="n">pt</span> <span class="o">-</span> <span class="n">p_tmp</span>
                    <span class="n">dist</span> <span class="o">=</span> <span class="n">p_tmp</span><span class="o">.</span><span class="n">length</span><span class="p">()</span>
                    <span class="n">ndist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s">&#39;dist&#39;</span><span class="p">:</span><span class="n">dist</span><span class="p">,</span><span class="s">&#39;node&#39;</span><span class="p">:</span><span class="n">n</span><span class="p">}</span> <span class="p">)</span>
                <span class="c"># sort the list by dist, sorts low to high</span>
                <span class="n">ndist</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ndist</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span><span class="p">[</span><span class="s">&#39;dist&#39;</span><span class="p">])</span>
                <span class="n">match_node</span> <span class="o">=</span> <span class="n">ndist</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;node&#39;</span><span class="p">]</span>
                <span class="n">N</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span> <span class="n">match_node</span> <span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">N</span>
                
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
            <span class="c"># assign part element and node sets</span>
            <span class="n">pname</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
            <span class="n">p</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="n">sets</span><span class="p">[</span><span class="s">&#39;E&#39;</span><span class="p">][</span><span class="n">pname</span><span class="p">]</span>
            <span class="n">p</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">sets</span><span class="p">[</span><span class="s">&#39;N&#39;</span><span class="p">][</span><span class="n">pname</span><span class="p">]</span>
            
            <span class="c"># assign all nodes and elements to areas, fix the element types</span>
            <span class="k">for</span> <span class="n">area</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">areas</span><span class="p">:</span>
                <span class="n">aname</span> <span class="o">=</span> <span class="n">area</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
                <span class="n">area</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="n">sets</span><span class="p">[</span><span class="s">&#39;E&#39;</span><span class="p">][</span><span class="n">aname</span><span class="p">]</span>
                <span class="n">area</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">sets</span><span class="p">[</span><span class="s">&#39;N&#39;</span><span class="p">][</span><span class="n">aname</span><span class="p">]</span>
                <span class="n">area</span><span class="o">.</span><span class="n">set_child_ccxtypes</span><span class="p">()</span> <span class="c">#paint element types on elements</span>
            
            <span class="c"># assign the child nodes to points</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get_points</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
                <span class="n">ndist</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                    <span class="n">p_tmp</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
                    <span class="n">p_tmp</span> <span class="o">=</span> <span class="n">pt</span> <span class="o">-</span> <span class="n">p_tmp</span>
                    <span class="n">dist</span> <span class="o">=</span> <span class="n">p_tmp</span><span class="o">.</span><span class="n">length</span><span class="p">()</span>
                    <span class="n">ndist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="s">&#39;dist&#39;</span><span class="p">:</span><span class="n">dist</span><span class="p">,</span><span class="s">&#39;node&#39;</span><span class="p">:</span><span class="n">n</span><span class="p">}</span> <span class="p">)</span>
                <span class="c"># sort the list by dist, sorts low to high</span>
                <span class="n">ndist</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ndist</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span><span class="p">[</span><span class="s">&#39;dist&#39;</span><span class="p">])</span>
                <span class="n">pt</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ndist</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;node&#39;</span><span class="p">]]</span>
                <span class="c">#print(&#39;Point %s = node %s&#39; % (pt, pt.nodes))</span>
            
            <span class="c"># assign the nodes and n1 and faces to lines</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get_lines</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="n">lname</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="n">sets</span><span class="p">[</span><span class="s">&#39;N&#39;</span><span class="p">][</span><span class="n">lname</span><span class="p">]</span>
                <span class="n">n1</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">order</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">faces</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">external</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">face</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">nodes</span><span class="p">)):</span>
                        <span class="n">faces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
                <span class="n">line</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">nodes</span>
                <span class="n">line</span><span class="o">.</span><span class="n">n1</span> <span class="o">=</span> <span class="n">n1</span>
                <span class="n">line</span><span class="o">.</span><span class="n">faces</span> <span class="o">=</span> <span class="n">faces</span>
                
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Done reading Calculix/Abaqus .inp file&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">()</span> <span class="c"># select all, adds nodes and elements to the selected set</span>
</div>
<div class="viewcode-block" id="FeaModel.mesh_cgx"><a class="viewcode-back" href="../../pycalculix.feamodel.html#pycalculix.feamodel.FeaModel.mesh_cgx">[docs]</a>    <span class="k">def</span> <span class="nf">mesh_cgx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fine</span><span class="p">):</span>
        <span class="c"># meshes the parts using calculix preprocessor</span>
        <span class="n">fbd</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">comps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cfiles</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c"># Calculix CGX elements</span>
        <span class="c"># axisymmetric</span>
        <span class="n">_cgx_elements</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">_cgx_elements</span><span class="p">[</span><span class="s">&#39;tri2axisym&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;tr6c&#39;</span>
        <span class="n">_cgx_elements</span><span class="p">[</span><span class="s">&#39;tri1axisym&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;tr3c&#39;</span>
        <span class="n">_cgx_elements</span><span class="p">[</span><span class="s">&#39;quad2axisym&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;qu8c&#39;</span>
        <span class="n">_cgx_elements</span><span class="p">[</span><span class="s">&#39;quad1axisym&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;qu4c&#39;</span>
        <span class="c"># plane stress</span>
        <span class="n">_cgx_elements</span><span class="p">[</span><span class="s">&#39;tri2plstress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;tr6s&#39;</span>
        <span class="n">_cgx_elements</span><span class="p">[</span><span class="s">&#39;tri1plstress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;tr3s&#39;</span>
        <span class="n">_cgx_elements</span><span class="p">[</span><span class="s">&#39;quad2plstress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;qu8s&#39;</span>
        <span class="n">_cgx_elements</span><span class="p">[</span><span class="s">&#39;quad1plstress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;qu4s&#39;</span>
        <span class="c"># plane strain</span>
        <span class="n">_cgx_elements</span><span class="p">[</span><span class="s">&#39;tri2plstrain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;tr6e&#39;</span>
        <span class="n">_cgx_elements</span><span class="p">[</span><span class="s">&#39;tri1plstrain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;tr3e&#39;</span>
        <span class="n">_cgx_elements</span><span class="p">[</span><span class="s">&#39;quad2plstrain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;qu8e&#39;</span>
        <span class="n">_cgx_elements</span><span class="p">[</span><span class="s">&#39;quad1plstrain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;qu4e&#39;</span>  
        
        <span class="n">num</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">fine</span>
        <span class="n">emult</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">num</span><span class="p">))</span> <span class="c"># this converts fineness to mesh multiplier</span>
        
        <span class="c"># write all points</span>
        <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">:</span>
            <span class="n">linestr</span> <span class="o">=</span> <span class="s">&#39;pnt </span><span class="si">%s</span><span class="s"> </span><span class="si">%f</span><span class="s"> </span><span class="si">%f</span><span class="s"> </span><span class="si">%f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="n">pt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">fbd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linestr</span><span class="p">)</span>
            <span class="c"># gmsh can&#39;t make node componenets so don&#39;t do it in cgx</span>
            <span class="c">#L = &#39;seta %s p %s&#39; % (pt.get_name(), pt.get_name())</span>
            <span class="c">#comps.append(L)            </span>
        
        <span class="c"># write all lines</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="n">ln</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
            <span class="n">linestr</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">geometry</span><span class="o">.</span><span class="n">Arc</span><span class="p">):</span>
                <span class="c"># line is arc</span>
                <span class="n">pc</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">actr</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
                <span class="n">linestr</span> <span class="o">=</span> <span class="s">&#39;line </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">pc</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># straight line</span>
                <span class="n">linestr</span> <span class="o">=</span> <span class="s">&#39;line </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
            <span class="c"># set division if we have it</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&#39;ediv&#39;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">get_lines</span><span class="p">():</span>
                        <span class="k">break</span>
                <span class="n">ndiv</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">eorder</span><span class="o">*</span><span class="n">line</span><span class="o">.</span><span class="n">ediv</span> 
                <span class="n">linestr</span> <span class="o">+=</span> <span class="s">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ndiv</span><span class="p">))</span>
            <span class="n">fbd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linestr</span><span class="p">)</span>
            <span class="n">L</span> <span class="o">=</span> <span class="s">&#39;seta </span><span class="si">%s</span><span class="s"> l </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">ln</span><span class="p">)</span>
            <span class="n">comps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
            <span class="n">cfiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span>
        
        <span class="c"># write all areas</span>
        <span class="k">for</span> <span class="n">area</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">areas</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">area</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
                <span class="n">linestr</span> <span class="o">=</span> <span class="s">&#39;gsur &#39;</span><span class="o">+</span><span class="n">area</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span><span class="o">+</span><span class="s">&#39; + BLEND &#39;</span>
                <span class="n">line_ids</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">area</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
                    <span class="n">char</span> <span class="o">=</span> <span class="s">&#39;+&#39;</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">sign</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">char</span> <span class="o">=</span> <span class="s">&#39;-&#39;</span>
                    <span class="n">line_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">char</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">+</span><span class="n">line</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
                <span class="n">linestr</span> <span class="o">=</span> <span class="n">linestr</span> <span class="o">+</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line_ids</span><span class="p">)</span>
                <span class="n">fbd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linestr</span><span class="p">)</span>
                <span class="c"># add area component, nodes + elements</span>
                <span class="n">L</span> <span class="o">=</span> <span class="s">&#39;seta </span><span class="si">%s</span><span class="s"> s </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">area</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="n">area</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
                <span class="n">comps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
                <span class="n">cfiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">area</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
                
        
        <span class="c"># write part area components</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
            <span class="c"># make components for each part, syntax</span>
            <span class="c"># seta P0 s s0 s1</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s">&#39;seta </span><span class="si">%s</span><span class="s"> s &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),)</span>
            <span class="n">cfiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
            <span class="n">area_ids</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">area</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">areas</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">area</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
                    <span class="n">area_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">area</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span> <span class="o">+</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">area_ids</span><span class="p">)</span>
            <span class="n">fbd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="c">#lines that mesh the part</span>
            <span class="n">part_comp</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
            
            <span class="c"># define the element types, and tells the program to mesh</span>
            <span class="n">estr</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">eshape</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">eorder</span><span class="p">)</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">etype</span>
            <span class="n">etype</span> <span class="o">=</span> <span class="n">_cgx_elements</span><span class="p">[</span><span class="n">estr</span><span class="p">]</span>
            <span class="n">fbd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;elty &#39;</span><span class="o">+</span><span class="n">part_comp</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">+</span><span class="n">etype</span><span class="p">)</span>
            <span class="n">fbd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;div all mult &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">emult</span><span class="p">))</span>
            <span class="c">#fbd.append(&#39;div all auto 2. 10. 0.5&#39;)</span>
            <span class="n">fbd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;mesh &#39;</span><span class="o">+</span><span class="n">part_comp</span><span class="p">)</span>
            <span class="c"># this is needed to select all nodes of the elements</span>

        <span class="c"># save mesh file</span>
        <span class="n">fbd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;send all abq&#39;</span><span class="p">)</span>        
        
        <span class="c"># add line and area components</span>
        <span class="n">fbd</span> <span class="o">+=</span> <span class="n">comps</span>
        
        <span class="c"># save component node and element sets</span>
        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">cfiles</span><span class="p">:</span>
            <span class="c"># select nodes under</span>
            <span class="n">fbd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;comp </span><span class="si">%s</span><span class="s"> do&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">comp</span><span class="p">,))</span>
            <span class="n">fbd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;send </span><span class="si">%s</span><span class="s"> abq names&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">comp</span><span class="p">,))</span>
        
        <span class="c"># this orients the view correctly</span>
        <span class="c"># this is the same as switching to the z+ orientation</span>
        <span class="c"># y us axial, x is radial</span>
        <span class="n">fbd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;rot z&#39;</span><span class="p">)</span>
        <span class="n">fbd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;rot c -90&#39;</span><span class="p">)</span>
        <span class="n">fbd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;plot e all&#39;</span><span class="p">)</span>
        
        <span class="c"># write fbd file to the local directory</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="o">+</span><span class="s">&#39;.fbd&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fbd</span><span class="p">:</span>
            <span class="c">#print (line)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">print</span> <span class="p">(</span><span class="s">&#39;File: &#39;</span><span class="o">+</span> <span class="n">fname</span> <span class="o">+</span> <span class="s">&#39; was written&#39;</span><span class="p">)</span>
        
        <span class="c"># run file in bg mode</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> -bg </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">environment</span><span class="o">.</span><span class="n">CGX</span><span class="p">,</span> <span class="n">fname</span><span class="p">),</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Meshing done!&#39;</span><span class="p">)</span>
        
        <span class="c"># assemble the output files into a ccx input file</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;all.msh&#39;</span><span class="p">]</span>
        <span class="n">files</span> <span class="o">+=</span> <span class="p">[</span><span class="n">f</span><span class="o">+</span><span class="s">&#39;.nam&#39;</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">cfiles</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="c"># cgx adds E and N prfixes on sets after =, get rid of these</span>
                <span class="k">if</span> <span class="s">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="n">fname</span> <span class="o">!=</span> <span class="s">&#39;all.msh&#39;</span><span class="p">:</span>
                    <span class="n">L</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;=&#39;</span> <span class="o">+</span> <span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="n">inp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">inp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            
            <span class="c"># delete file</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        
        <span class="c"># write out inp file</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="o">+</span><span class="s">&#39;.inp&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">inp</span><span class="p">:</span>
            <span class="c">#print (line)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">print</span> <span class="p">(</span><span class="s">&#39;File: &#39;</span><span class="o">+</span> <span class="n">fname</span> <span class="o">+</span> <span class="s">&#39; was written&#39;</span><span class="p">)</span>

        <span class="c"># read in the calculix mesh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_inp</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">pycalculix  documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, Author.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>